<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Kaşıkmate Odası - <%= project.name %></title>
    <meta name="description" content="Kaşıkmate Proje Odası">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://kit.fontawesome.com/6510466b6c.js" crossorigin="anonymous"></script>
    <!-- Oda ve kullanıcı bilgilerini JavaScript'e aktar -->
    <script>
        const ROOM_ID = "<%= project._id %>";
        const USER_USERNAME = "<%= user.username %>";
        const USER_ID = "<%= user._id %>";
    </script>
</head>

<body class="room-page">    <!-- Modern Header Bar -->
    <div class="room-header">
        <div class="room-header-left">
            <div class="room-logo">Kaşıkmate</div>
            <div class="room-project-info">
                <span class="room-project-name"><%= project.name %></span>
                <span class="room-code-display">
                    <i class="fas fa-key"></i>
                    Oda Kodu: <%= project._id %>
                    <button class="copy-code-btn" onclick="copyRoomId()" title="Kodu Kopyala">
                        <i class="fas fa-copy"></i>
                    </button>
                </span>
            </div>
        </div>
        <div class="room-header-right">
            <button class="header-btn dashboard-btn" id="dashboard-redirect-btn" title="Kontrol Paneline Dön">
                <i class="fas fa-tachometer-alt"></i>
                Panel
            </button>
        </div>
    </div>

    <div class="overlay" id="overlay" style="display: none;">
        <div class="box modern-box">
            <div class="head-name">Kullanıcı Adı</div>
            <input type="text" class="name-field modern-input" id="name-field" value="<%= user.username %>" readonly>
            <button class="continue-name primary-btn">Devam Et</button>
        </div>
    </div>

    <div class="modern-room-container">        <div class="video-section">
            <div class="video-container-modern" id="vcont">
                <div class="video-box-modern">
                    <video class="video-frame-modern" id="vd1" autoplay playsinline></video>
                    <div class="video-overlay">
                        <div class="nametag-modern" id="myname"><%= user.username %></div>
                        <div class="mute-icon-modern" id="mymuteicon"><i class="fas fa-microphone-slash"></i></div>
                        <div class="video-off-modern" id="myvideooff">
                            <i class="fas fa-video-slash"></i>
                            <span>Video Kapalı</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="control-buttons">
                    <button class="control-btn audio-btn tooltip" data-tooltip="Sesi Aç/Kapat">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="control-btn video-btn tooltip" data-tooltip="Videoyu Aç/Kapat">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="control-btn screenshare-btn tooltip" data-tooltip="Ekran Paylaş">
                        <i class="fas fa-desktop"></i>
                    </button>
                    <button class="control-btn whiteboard-btn tooltip" data-tooltip="Beyaz Tahta">
                        <i class="fas fa-chalkboard"></i>
                    </button>
                    <button class="control-btn disconnect-btn tooltip" data-tooltip="Ayrıl">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="whiteboard-section">
            <div class="whiteboard-container">
                <canvas id="whiteboard" height="1000" width="1000"></canvas>
                <div class="whiteboard-tools">
                    <div class="tool-category">
                        <span class="tool-label">Renkler</span>
                        <div class="color-palette">
                            <div class="color-option black" onclick="setColor('black')" title="Siyah"></div>
                            <div class="color-option red" onclick="setColor('#e74c3c')" title="Kırmızı"></div>
                            <div class="color-option yellow" onclick="setColor('#f1c40f')" title="Sarı"></div>
                            <div class="color-option green" onclick="setColor('#27ae60')" title="Yeşil"></div>
                            <div class="color-option blue" onclick="setColor('#3498db')" title="Mavi"></div>
                            <div class="color-option orange" onclick="setColor('#e67e22')" title="Turuncu"></div>
                            <div class="color-option purple" onclick="setColor('#9b59b6')" title="Mor"></div>
                            <div class="color-option pink" onclick="setColor('#fd79a8')" title="Pembe"></div>
                        </div>
                    </div>
                    <div class="tool-category">
                        <span class="tool-label">Araçlar</span>
                        <div class="tool-buttons">
                            <button class="tool-btn" onclick="setEraser()" title="Silgi">
                                <i class="fas fa-eraser"></i>
                            </button>
                            <button class="tool-btn clear-btn" onclick="clearBoard()" title="Temizle">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>        <div class="sidebar-panel">
            <div class="sidebar-header">
                <div class="project-title-modern">
                    <i class="fas fa-project-diagram"></i>
                    <%= project.name %>
                </div>
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="chat">
                        <i class="fas fa-comment-alt"></i>
                        <span>Sohbet</span>
                    </button>
                    <button class="sidebar-tab" data-tab="notes">
                        <i class="fas fa-sticky-note"></i>
                        <span>Notlar</span>
                    </button>
                    <button class="sidebar-tab" data-tab="attendees">
                        <i class="fas fa-users"></i>
                        <span>Katılımcılar</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-content">
                <div class="tab-panel active" id="chat-tab">
                    <div class="chat-messages" id="chat-cont"></div>
                    <div class="chat-input-section">
                        <div class="chat-input-wrapper">
                            <input type="text" class="chat-input-modern" placeholder="Mesaj yazın..." id="chat-input">
                            <button class="chat-send-btn" id="chat-send">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-panel" id="notes-tab">
                    <div class="notes-header-modern">
                        <button id="add-note-btn" class="add-note-btn-modern">
                            <i class="fas fa-plus"></i>
                            Yeni Not Ekle
                        </button>
                    </div>
                    <div class="notes-list-modern" id="notes-list"></div>
                    <div class="note-editor-modern" id="note-editor" style="display:none;">
                        <div class="note-editor-header">
                            <button id="save-note-btn" class="save-note-btn-modern">
                                <i class="fas fa-save"></i>
                                Kaydet
                            </button>
                            <button id="cancel-note-btn" class="cancel-note-btn-modern">
                                <i class="fas fa-times"></i>
                                İptal
                            </button>
                        </div>
                        <textarea id="note-content" class="note-textarea-modern" placeholder="Notunuzu buraya yazın..."></textarea>
                    </div>
                </div>

                <div class="tab-panel" id="attendees-tab">
                    <div class="attendees-list-modern" id="attendees-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script src="/js/room.js?v=<%= Date.now() %>"></script> <!-- Cache busting için versiyon eklendi -->    <script>
        // Odaya geri dönmek için buton
        const dashboardRedirectBtn = document.getElementById('dashboard-redirect-btn');
        if(dashboardRedirectBtn){
            dashboardRedirectBtn.addEventListener('click', () => {
                window.location.href = '/dashboard';
            });
        }

        function copyRoomId() {
            const roomId = "<%= project._id %>";
            navigator.clipboard.writeText(roomId).then(() => {
                // Modern notification
                showNotification("Oda kodu kopyalandı!", "success");
            }).catch(err => {
                console.error('Oda kodu kopyalanamadı: ', err);
                showNotification("Kopyalama başarısız oldu.", "error");
            });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
